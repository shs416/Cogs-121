<!doctype html>
<html lang="en">
<head>

    <title>My Vaccines &mdash; Home</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Favicons -->

    <link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/assets/img/favicons/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="/assets/img/favicons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/assets/img/favicons/android-chrome-192x192.png" sizes="192x192">
    <meta name="msapplication-square70x70logo" content="/assets/img/favicons/smalltile.png" />
    <meta name="msapplication-square150x150logo" content="/assets/img/favicons/mediumtile.png" />
    <meta name="msapplication-wide310x150logo" content="/assets/img/favicons/widetile.png" />
    <meta name="msapplication-square310x310logo" content="/assets/img/favicons/largetile.png" />

    <!-- Styles -->

    <style type="text/css" media="screen">

        .age-chart {
            /* height: 50px; */
            width: 90vw;
            background: #efefef;
            border: 1px solid #aaa;
            margin: 0 auto 3rem;

            display: grid;
            grid-template-columns: 2fr repeat(5, 1fr);
            grid-template-rows: repeat(17, 1fr);
            /* grid-gap: 0.5rem; */

            align-items: center;
            /* justify-content: center; */

        }


        .age-chart > * {
            /* padding: 10px; */
            border: 1px solid #bbb;
            padding: 10px;
            text-align: center;
            /* align-content: center; */
        }

        .age-chart .heading {
            background: teal;
            color: white;
            font-weight: bold;
            font-size: 1.15rem;
            border-color: #ddd;
        }

        .age-chart .vaccine {
            background: white;
            color: teal;
            font-weight: bold;

        }

        .age-chart .span {
            background: #bada55;
        }

        .age-chart .span--a {
            background: #6ed7ff;
        }

        .age-chart .span--influenza {
            grid-column-start: 2;
            grid-column-end: 7;
        }

        .age-chart .span--influenza-a {
            grid-column-start: 2;
            grid-column-end: 5;
        }

        .vaccine--or {
            position: relative;
            border-bottom: 2px dotted black;
        }

        .vaccine--or:after {
            content: 'OR';
            background: teal;
            color: white;
            /* width: 25px;
            height: 25px; */
            padding: 2px;
            border-radius: 50%;
            border: 1px solid #bada55;
            position: absolute;
            top: 30px;
            /* left: -0; */
            right: 11vw;
        }

        .vaccine--influenza, .span--influenza {
            position: relative;
            border-bottom: 2px dotted black;
        }

        .span-2-7 {
            grid-column-start: 2;
            grid-column-end: 7;
        }

        .span-2-5 {
            grid-column-start: 2;
            grid-column-end: 5;
        }

        .span-2-3 {
            grid-column-start: 2;
            grid-column-end: 3;
        }

        .span-2-4 {
            grid-column-start: 2;
            grid-column-end: 4;
        }

        .span-3-4 {
            grid-column-start: 3;
            grid-column-end: 4;
        }

        .span-2-6 {
            grid-column-start: 2;
            grid-column-end: 6;
        }

        .span-5-7 {
            grid-column-start: 5;
            grid-column-end: 7;
        }

        .span-6-7 {
            grid-column-start: 6;
            grid-column-end: 7;
        }

        .row-4 { grid-row-start: 4; }
        .row-5 { grid-row-start: 5; }
        .row-6 { grid-row-start: 6; }
        .row-7 { grid-row-start: 7; }
        .row-8 { grid-row-start: 8; }
        .row-9 { grid-row-start: 9; }
        .row-10 { grid-row-start: 10; }
        .row-11 { grid-row-start: 11; }
        .row-12 { grid-row-start: 12; }
        .row-13 { grid-row-start: 13; }

        .legend {
            width: 70vw;
            margin: 2rem auto 2rem;
            display: grid;
            grid-template-columns: 1fr 3fr 1fr 3fr;
            /* grid-gap: 1rem; */
        }

        .legend > * {
            padding: 1.25rem;
        }

        /* .legend .color {
            border-top: 2px solid black;
            border-bottom: 2px solid black;
            border-left: 2px solid black;
        }

        .legend .ref {
            border-top: 2px solid black;
            border-bottom: 2px solid black;
            border-right: 2px solid black;
        } */

        .legend .ref--green {
            background: #e9ffa3;
            margin-right: 2rem;
        }

        .legend .ref--blue {
            background: #c5efff;
        }

        .color--green {
            background: #bada55;
        }

        .color--blue {
            background: #6ed7ff;
        }

    </style>

<!--     <link href="/assets/css/style.min.css" rel="stylesheet" type="text/css" media="all"/>
 -->
    <!-- Social Tags -->

    <meta name="description" content="" />

    <meta property="og:title" content="Home" />
    <meta property="og:description" content="" />
    <meta property="og:url" content="/"/>
    <meta property="og:site_name" content="Bare"/>
    <meta property="og:image" content=""/>

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="Bare">
    <meta name="twitter:title" content="Home">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="">

    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" type="text/html" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">


    <script src="https://www.gstatic.com/firebasejs/5.11.0/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyD47cJGwFkIc9siMnsw0om2jxesLkfwtEY",
        authDomain: "cogs-121-vaccine-app.firebaseapp.com",
        databaseURL: "https://cogs-121-vaccine-app.firebaseio.com",
        projectId: "cogs-121-vaccine-app",
        storageBucket: "cogs-121-vaccine-app.appspot.com",
        messagingSenderId: "629787599584"
      };
      firebase.initializeApp(config);
    </script>


    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <script src="jquery-3.3.1.min.js"></script>


    <script type="text/javascript">
    const database = firebase.database();

   function moveToCompleted(vacName) {
        if(document.getElementById(vacName).checked) {
            // move items
            database.ref("vaccines/" + vacName + "/info/").update({status: "completed"});
            console.log(vacName + "updated");

            $("#pending_vaccines tbody").empty();
            $("#completed_vaccines tbody").empty();
            populatePending();
            populateCompleted();
        }
    }

   function moveToPending(buttonId, vacName) {
        if(document.getElementById(buttonId)) {
            // move items
            database.ref("vaccines/" + vacName + "/info/").update({status: "pending"});
            console.log(vacName + "updated");

            $("#pending_vaccines tbody").empty();
            $("#completed_vaccines tbody").empty();
            populatePending();
            populateCompleted();
        }
    }

    function populatePending() {
        database.ref('vaccines/').once('value', (snapshot) => {
            const data = snapshot.val();

            snapshot.forEach((child) => {
                const vaccineName = child.val().info['name'];

                if(child.val().info['status'] == 'pending') {
                    console.log("pending", child.val().info['name']);
                    $('#pending_vaccines > tbody:last-child').append(
                        '<tr><td><label><input type="checkbox" id="' +
                        vaccineName + '"' + 'onChange="moveToCompleted(\'' + vaccineName
                        + '\');" />' + '<span>'
                        + '</span></label></td>' +
                        '<td>' + vaccineName + '</td>' +
                        '<td>' + child.val().info['starting age'] + '</td>'
                        + '<td>' + child.val().info['ending age'] + '</td>'
                        + '<td>' + child.val().info['number of doses'] + '</td>'
                        + '</tr>'

                    );
                }
            });
        });
    }


    function populateCompleted() {
        database.ref('vaccines/').once('value', (snapshot) => {
            const data = snapshot.val();
            snapshot.forEach((child) => {

                const vaccineName = child.val().info['name'];
                const backToPendingButton = vaccineName + "_back_to_pending_button";
                if(child.val().info['status'] == 'completed') {
                    console.log("completed", child.val().info['name']);

                    $('#completed_vaccines > tbody:last-child').append(
                        '<tr>' +
                        '<td>' + vaccineName + '</td>' +
                        '<td>' + child.val().info['starting age'] + '</td>'
                        + '<td>' + child.val().info['ending age'] + '</td>'
                        + '<td>' + child.val().info['number of doses'] + '</td>'
                        + '<td><button class=btn id="' + backToPendingButton
                        + '"' + 'onClick="moveToPending(\'' + backToPendingButton
                        + '\', \''
                        + vaccineName +
                        '\');" >' + 'Move to Pending' + '</button>' + '</td></tr>'
                    );
                }
            });
        });
    }

    /*function capFirstLetter(string) {
        return string.charAt(0).toUpperCase() + string.slice(1);
    }*/

    $(document).ready(() => {

        const database = firebase.database();
        populatePending();
        populateCompleted();



        $('#viewAllVaccineButton').click(() => {

            database.ref('vaccines/').once('value', (snapshot) => {
                const data = snapshot.val();
                console.log('Vaccine data: ', (data));


                $('#vaccineDiv').html('All vaccines: ' + Object.keys(data));
            });
        });

        $('#hideAllVaccineButton').click(() => {
            $('#vaccineDiv').html('');

        });

        $('#infoButton').click(() => {
            const key = 'vaccines/' + $('#nameBox').val()//.toLowerCase();
            const vaccineName = $('#nameBox').val();
            console.log('Vaccine data for ', key);

            database.ref(key).once('value', (snapshot) => {
                const data = snapshot.val();

                if(data) {
                    snapshot.forEach((child) => {
                        console.log(child.val());
                        $('#vaccineInfoDiv').html('Info for ' + child.val()['name'] + '<br />'
                            + 'Description: ' + child.val()['description'] + '<br />'
                            + 'How it spreads: ' + child.val()['transmitted'] + '<br />'
                            + 'Starting age: ' + child.val()['starting age'] + '<br />'
                            + 'Ending age: ' + child.val()['ending age'] + '<br />'
                            + 'Number of doses: ' + child.val()['number of doses']

                        );
                    });
                    //console.log('Vaccine data: ', (data));
                }
                else {
                    $('#vaccineInfoDiv').html('Vaccine not found!');
                }
            });
        });

        // define a generic Ajax error handler:
        $(document).ajaxError(() => {
            $('#vaccineDiv').html('Error: unknown ajaxError!');
        });
    });

    </script>
</head>


<body>
    <nav>
        <div class="nav-wrapper" id="indexNav" style="background-color:#26a69a;">
          <a href="index.html" class="brand-logo" style="padding-left:10px">Vacc Tracc</a>
              <ul id="nav-mobile" class="right hide-on-med-and-down">
                    <li class="active"><a href="index.html">My Vaccines</a></li>
                    <li><a href="news.html">News Feed</a></li>
              </ul>
        </div>
   </nav>

    <div class="row">
        <div class="col s12 m6 l6">

            <h4>Pending Vaccines</h4>
            <table style="width:100%" id="pending_vaccines">
                <thead>
                    <tr>
                        <th>Completed?</th>
                        <th>Name</th>
                        <th>Starting age</th>
                        <th>Ending age</th>
                        <th>Number of doses</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>

        </div>

        <div class="col s12 m6 l6">
            <h4>Completed Vaccines</h4>
            <table style="width:100%" id="completed_vaccines">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Starting age</th>
                        <th>Ending age</th>
                        <th>Number of doses</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

    </div>
<br><br>
    <section class="age-chart">
        <!-- headings -->
        <div class="heading">
            Vaccine
        </div>
        <div class="heading">
            19-21 years
        </div>
        <div class="heading">
            22-26 years
        </div>
        <div class="heading">
            27-49 years
        </div>
        <div class="heading">
            50-64 years
        </div>
        <div class="heading">
            >= 65 years
        </div>

        <div class="vaccine vaccine--influenza vaccine--or">
            Influenza
        </div>

        <div class="span span--influenza">
            1 dose anually
        </div>

        <!-- <div class="vaccine vaccine--influenza-a">
            Influenza Attenuated
        </div>
        <div class="span span--influenza-a">
            1 dose anually
        </div> -->

        <div class="vaccine">Influenza Attenuated</div>
        <div class="span span--influenza-a">
            1 dose anually
        </div>

        <div class="vaccine row-4">TDAP</div>
        <div class="span span-2-7">1 dose TDAP, then TD Booster every 10 years</div>

        <div class="vaccine">MMR</div>
        <div class="span span-2-6">1 or 2 doses depending upon indication</div>

        <div class="vaccine row-6">Varicella</div>
        <div class="span span-2-5">2 doses</div>

        <div class="vaccine vaccine--or row-7">Zoster Recombinant</div>
        <div class="span row-7 span-5-7">2 doses</div>

        <div class="vaccine row-8">Zoster Live</div>
        <div class="span row-8 span-6-7">1 doses</div>

        <div class="vaccine row-9">HPV Female</div>
        <div class="span row-9 span-2-4">2 or 3 doses depending on age at initial vaccination</div>

        <div class="vaccine row-10">HPV Male</div>
        <div class="span row-10 span-2-3">2 or 3 doses depending	on age at initial vaccination</div>
        <div class="span span--a row-10 span-3-4">2 or 3 doses depending on age at initial vaccination</div>

        <div class="vaccine row-11">PCV13</div>
        <div class="span row-11 span-2-6">1 dose</div>
        <div class="span span--a row-11 span-6-7">1 dose</div>

        <div class="vaccine row-12">PPSV23</div>
        <div class="span row-12 span-2-6">1 or 2 doses depending on indication</div>
        <div class="span span--a row-12 span-6-7">1 dose</div>

        <div class="vaccine row-13">Hepatitis A</div>
        <div class="span span--a span-2-7">2 or 3 doses depending on vaccine</div>

        <div class="vaccine row-14">Hepatitis B</div>
        <div class="span span--a span-2-7">2 or 3 doses depending on vaccine</div>

        <div class="vaccine row-15">Meningococcal A, C, W, Y</div>
        <div class="span span--a span-2-7">1 or 2 doses depending on indication, then booster every 5 yrs if risk remains</div>

        <div class="vaccine row-16">Meningococcal B</div>
        <div class="span span--a span-2-7">2 or 3 doses depending on vaccine and indication</div>

        <div class="vaccine row-17">Haemophilus influenzae type b</div>
        <div class="span span--a span-2-7">1 or 3 doses depending on indication</div>

    </section>

    <center><h5>Legend</h3></center>

    <article class="legend">
        <div class="color color--green"></div>
        <div class="ref ref--green">Recommended vaccination for adults who meet age requirement, lack documentation of vaccination, or lack evidence of past infection</div>

        <div class="color color--blue"></div>
        <div class="ref ref--blue">Recommended vaccination for adults with an additional risk factor or another indication

</div>
    </article>

    <div class="row">
        <div class="col s8 push-s2">
            <br></br>
        <center>
            <h4>Learn More About Vaccines</h4><br></br>
            <button class="btn" id="viewAllVaccineButton">
                <i class="material-icons left">visibility</i>
                View All Vaccines
            </button>
            <button class="btn" id="hideAllVaccineButton">
                <i class="material-icons left">visibility_off</i>
                Hide All Vaccines
            </button>
            <br><br>
            <div id="vaccineDiv"></div>
        </center>
    </div>



    </div>

    <div class="row">
        <div class="input-field col s8 push-s2">
            <i class="material-icons prefix left">search</i>
            <label for="nameBox">Look Up a Vaccine: </label>
            <input id="nameBox" type="text" size="20"/>

            <center>
                <button class="btn" id="infoButton">Get info</button>
            </center>
                <br><br>
                <div id="vaccineInfoDiv"></div>


            <!-- <i class="material-icons prefix left">search</i>
            <input id = "searchBar" type="text" placeholder="Search..">
            <center>
                <button id="searchNews" class="btn waves-light">Search</button>
            </center> -->
        </div>
    </div>


    <footer class="">
<small>

</small>
</footer>

    <!-- Google Analytics -->

<!--    <script src="http://localhost:35729/livereload.js"></script> -->

</body>
</html>
