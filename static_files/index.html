<!doctype html>
<html lang="en">
<head>

    <title>My Vaccines &mdash; Bare</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Favicons -->

    <link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/assets/img/favicons/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="/assets/img/favicons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/assets/img/favicons/android-chrome-192x192.png" sizes="192x192">
    <meta name="msapplication-square70x70logo" content="/assets/img/favicons/smalltile.png" />
    <meta name="msapplication-square150x150logo" content="/assets/img/favicons/mediumtile.png" />
    <meta name="msapplication-wide310x150logo" content="/assets/img/favicons/widetile.png" />
    <meta name="msapplication-square310x310logo" content="/assets/img/favicons/largetile.png" />

    <!-- Styles -->

<!--     <link href="/assets/css/style.min.css" rel="stylesheet" type="text/css" media="all"/>
 -->
    <!-- Social Tags -->

    <meta name="description" content="" />

    <meta property="og:title" content="Home" />
    <meta property="og:description" content="" />
    <meta property="og:url" content="/"/>
    <meta property="og:site_name" content="Bare"/>
    <meta property="og:image" content=""/>

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="Bare">
    <meta name="twitter:title" content="Home">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="">

    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" type="text/html" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">


    <script src="https://www.gstatic.com/firebasejs/5.11.0/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyD47cJGwFkIc9siMnsw0om2jxesLkfwtEY",
        authDomain: "cogs-121-vaccine-app.firebaseapp.com",
        databaseURL: "https://cogs-121-vaccine-app.firebaseio.com",
        projectId: "cogs-121-vaccine-app",
        storageBucket: "cogs-121-vaccine-app.appspot.com",
        messagingSenderId: "629787599584"
      };
      firebase.initializeApp(config);
    </script>


    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <script src="jquery-3.3.1.min.js"></script>


    <script type="text/javascript">
    const database = firebase.database();

   function moveToCompleted(vacName) {
        if(document.getElementById(vacName).checked) {
            // move items
            database.ref("vaccines/" + vacName + "/info/").update({status: "completed"});
            console.log(vacName + "updated");

            $("#pending_vaccines tbody").empty();
            $("#completed_vaccines tbody").empty();
            populatePending();
            populateCompleted();
        }
    }

   function moveToPending(buttonId, vacName) {
        if(document.getElementById(buttonId)) {
            // move items
            database.ref("vaccines/" + vacName + "/info/").update({status: "pending"});
            console.log(vacName + "updated");

            $("#pending_vaccines tbody").empty();
            $("#completed_vaccines tbody").empty();
            populatePending();
            populateCompleted();
        }
    }

    function populatePending() {
        database.ref('vaccines/').once('value', (snapshot) => {
            const data = snapshot.val();

            snapshot.forEach((child) => {
                const vaccineName = child.val().info['name'];

                if(child.val().info['status'] == 'pending') {
                    console.log("pending", child.val().info['name']);
                    $('#pending_vaccines > tbody:last-child').append(
                        '<tr><td><label><input type="checkbox" id="' +
                        vaccineName + '"' + 'onChange="moveToCompleted(\'' + vaccineName
                        + '\');" />' + '<span>'
                        + '</span></label></td>' +
                        '<td>' + vaccineName + '</td>' +
                        '<td>' + child.val().info['starting age'] + '</td>'
                        + '<td>' + child.val().info['ending age'] + '</td>'
                        + '<td>' + child.val().info['number of doses'] + '</td>'
                        + '</tr>'                    

                    );
                }
            });
        });
    }


    function populateCompleted() {
        database.ref('vaccines/').once('value', (snapshot) => {
            const data = snapshot.val();
            snapshot.forEach((child) => {

                const vaccineName = child.val().info['name'];
                const backToPendingButton = vaccineName + "_back_to_pending_button";
                if(child.val().info['status'] == 'completed') {
                    console.log("completed", child.val().info['name']);

                    $('#completed_vaccines > tbody:last-child').append(
                        '<tr>' +
                        '<td>' + vaccineName + '</td>' +
                        '<td>' + child.val().info['starting age'] + '</td>'
                        + '<td>' + child.val().info['ending age'] + '</td>'
                        + '<td>' + child.val().info['number of doses'] + '</td>'
                        + '<td><button class=btn id="' + backToPendingButton
                        + '"' + 'onClick="moveToPending(\'' + backToPendingButton 
                        + '\', \''
                        + vaccineName + 
                        '\');" >' + 'Move to Pending' + '</button>' + '</td></tr>'  
                    );
                }
            });
        });
    }

    /*function capFirstLetter(string) {
        return string.charAt(0).toUpperCase() + string.slice(1);
    }*/

    $(document).ready(() => {

        const database = firebase.database();
        populatePending();
        populateCompleted();



        $('#viewAllVaccineButton').click(() => {

            database.ref('vaccines/').once('value', (snapshot) => {
                const data = snapshot.val();
                console.log('Vaccine data: ', (data));


                $('#vaccineDiv').html('All vaccines: ' + Object.keys(data));
            });
        });

        $('#hideAllVaccineButton').click(() => {
            $('#vaccineDiv').html('');

        });

        $('#infoButton').click(() => {
            const key = 'vaccines/' + $('#nameBox').val()//.toLowerCase();
            const vaccineName = $('#nameBox').val();
            console.log('Vaccine data for ', key);

            database.ref(key).once('value', (snapshot) => {
                const data = snapshot.val();

                if(data) {
                    snapshot.forEach((child) => {
                        console.log(child.val());
                        $('#vaccineInfoDiv').html('Info for ' + child.val()['name'] + '<br />'
                            + 'Description: ' + child.val()['description'] + '<br />'
                            + 'How it spreads: ' + child.val()['transmitted'] + '<br />'
                            + 'Starting age: ' + child.val()['starting age'] + '<br />'
                            + 'Ending age: ' + child.val()['ending age'] + '<br />'
                            + 'Number of doses: ' + child.val()['number of doses']

                        );
                    });
                    //console.log('Vaccine data: ', (data));
                }
                else {
                    $('#vaccineInfoDiv').html('Vaccine not found!');
                }
            });
        });

        // define a generic Ajax error handler:
        $(document).ajaxError(() => {
            $('#vaccineDiv').html('Error: unknown ajaxError!');
        });
    });

    </script>
</head>


<body>
    <nav>
        <div class="nav-wrapper" id="indexNav" style="background-color:#26a69a;">
          <a href="index.html" class="brand-logo" style="padding-left:10px">Vacc Tracc</a>
              <ul id="nav-mobile" class="right hide-on-med-and-down">
                    <li class="active"><a href="index.html">My Vaccines</a></li>
                    <li><a href="news.html">News Feed</a></li>
              </ul>
        </div>
   </nav>

    <div class="row">
        <div class="col s12 m6 l6">

            <h4>Pending Vaccines</h4>
            <table style="width:100%" id="pending_vaccines">
                <thead>
                    <tr>
                        <th>Completed?</th>
                        <th>Name</th>
                        <th>Starting age</th>
                        <th>Ending age</th>
                        <th>Number of doses</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>

        </div>

        <div class="col s12 m6 l6">
            <h4>Completed Vaccines</h4>
            <table style="width:100%" id="completed_vaccines">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Starting age</th>
                        <th>Ending age</th>
                        <th>Number of doses</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

    </div>
<br><br>
    <div class="row">
        <div class="col s8 push-s2">
            <br></br>
        <center>
            <h4>Learn More About Vaccines</h4><br></br>
            <button class="btn" id="viewAllVaccineButton">
                <i class="material-icons left">visibility</i>
                View All Vaccines
            </button>
            <button class="btn" id="hideAllVaccineButton">
                <i class="material-icons left">visibility_off</i>
                Hide All Vaccines
            </button>
            <br><br>
            <div id="vaccineDiv"></div>
        </center>
    </div>



    </div>

    <div class="row">
        <div class="input-field col s8 push-s2">
            <i class="material-icons prefix left">search</i>
            <label for="nameBox">Look Up a Vaccine: </label>
            <input id="nameBox" type="text" size="20"/>

            <center>
                <button class="btn" id="infoButton">Get info</button>
            </center>
                <br><br>
                <div id="vaccineInfoDiv"></div>


            <!-- <i class="material-icons prefix left">search</i>
            <input id = "searchBar" type="text" placeholder="Search..">
            <center>
                <button id="searchNews" class="btn waves-light">Search</button>
            </center> -->
        </div>
    </div>


    <footer class="">
<small>

</small>
</footer>

    <!-- Google Analytics -->

<!--    <script src="http://localhost:35729/livereload.js"></script> -->

</body>
</html>
